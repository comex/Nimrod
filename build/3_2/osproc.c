/* Generated by Nimrod Compiler v0.8.9 */
/*   (c) 2010 Andreas Rumpf */

typedef long long int NI;
typedef unsigned long long int NU;
#include "nimbase.h"

#include <sys/sysctl.h>
#include <pthread.h>
#include <unistd.h>
#include <string.h>
#include <errno.h>
#include <signal.h>
#include <sys/wait.h>
typedef struct NimStringDesc NimStringDesc;
typedef struct TGenericSeq TGenericSeq;
typedef struct TY66202 TY66202;
typedef struct TNimObject TNimObject;
typedef struct TNimType TNimType;
typedef struct TNimNode TNimNode;
typedef struct TY4377 TY4377;
typedef struct TY10802 TY10802;
typedef struct TY11190 TY11190;
typedef struct TY10818 TY10818;
typedef struct TY10814 TY10814;
typedef struct TY10810 TY10810;
typedef struct TY11188 TY11188;
typedef struct TY66698 TY66698;
typedef struct TY65027 TY65027;
typedef struct TY64408 TY64408;
typedef struct TY44006 TY44006;
typedef struct TY44004 TY44004;
typedef struct TY65323 TY65323;
struct TGenericSeq {
NI len;
NI space;
};
typedef NIM_CHAR TY239[100000001];
struct NimStringDesc {
  TGenericSeq Sup;
TY239 data;
};
struct TNimType {
NI size;
NU8 kind;
NU8 flags;
TNimType* base;
TNimNode* node;
void* finalizer;
};
struct TNimObject {
TNimType* m_type;
};
struct TY66202 {
  TNimObject Sup;
int Inputhandle;
int Outputhandle;
int Errorhandle;
int Id;
int Exitcode;
};
typedef int TY66404[4];
struct TNimNode {
NU8 kind;
NI offset;
TNimType* typ;
NCSTRING name;
NI len;
TNimNode** sons;
};
struct TY10802 {
NI Refcount;
TNimType* Typ;
};
struct TY10818 {
NI Len;
NI Cap;
TY10802** D;
};
struct TY10814 {
NI Counter;
NI Max;
TY10810* Head;
TY10810** Data;
};
struct TY11188 {
NI Stackscans;
NI Cyclecollections;
NI Maxthreshold;
NI Maxstacksize;
NI Maxstackcells;
NI Cycletablesize;
};
struct TY11190 {
TY10818 Zct;
TY10818 Decstack;
TY10814 Cycleroots;
TY10818 Tempstack;
NI Cyclerootslock;
NI Zctlock;
TY11188 Stat;
};
typedef N_NIMCALL_PTR(void, TY65028) (TY65027* S_65029);
typedef N_NIMCALL_PTR(NIM_BOOL, TY65032) (TY65027* S_65033);
typedef N_NIMCALL_PTR(void, TY65036) (TY65027* S_65037, NI Pos_65038);
typedef N_NIMCALL_PTR(NI, TY65041) (TY65027* S_65042);
typedef N_NIMCALL_PTR(NI, TY65045) (TY65027* S_65046, void* Buffer_65047, NI Buflen_65048);
typedef N_NIMCALL_PTR(void, TY65051) (TY65027* S_65052, void* Buffer_65053, NI Buflen_65054);
struct TY65027 {
  TNimObject Sup;
TY65028 Close;
TY65032 Atend;
TY65036 Setposition;
TY65041 Getposition;
TY65045 Readdata;
TY65051 Writedata;
};
struct TY44004 {
NimStringDesc* Key;
NimStringDesc* Val;
};
struct TY64408 {
  TNimObject Sup;
NI Counter;
TY44006* Data;
NU8 Mode;
};
typedef int TY67344[2];
typedef NimStringDesc* TY46867[1];
typedef NimStringDesc* TY67430[2];
typedef NI TY8814[8];
struct TY10810 {
TY10810* Next;
NI Key;
TY8814 Bits;
};
struct TY65323 {
  TY65027 Sup;
FILE* F;
};
struct TY4377 {
  TGenericSeq Sup;
  NimStringDesc* data[SEQ_DECL_SIZE];
};
struct TY66698 {
  TGenericSeq Sup;
  TY66202* data[SEQ_DECL_SIZE];
};
struct TY44006 {
  TGenericSeq Sup;
  TY44004 data[SEQ_DECL_SIZE];
};
N_NIMCALL(NimStringDesc*, Executeprocess_66222)(NimStringDesc* Command_66224, NU8 Options_66227);
N_NIMCALL(NI, Executecommand_66232)(NimStringDesc* Command_66234);
N_NIMCALL(NI, nospprocessID)(TY66202* P_66263);
N_NIMCALL(NI, nospcountProcessors)(void);
N_NIMCALL(TY66202*, Startprocessaux_66603)(NimStringDesc* Cmd_66605, NU8 Options_66607);
N_NIMCALL(TY4377*, nosparseCmdLine)(NimStringDesc* C_39634);
N_NIMCALL(void*, newSeq)(TNimType* Typ_13004, NI Len_13005);
static N_INLINE(NI, subInt)(NI A_6003, NI B_6004);
N_NOINLINE(void, raiseOverflow)(void);
N_NOINLINE(void, raiseIndexError)(void);
N_NIMCALL(TGenericSeq*, incrSeq)(TGenericSeq* Seq_17635, NI Elemsize_17636);
static N_INLINE(void, asgnRefNoCycle)(void** Dest_12018, void* Src_12019);
static N_INLINE(TY10802*, Usrtocell_11236)(void* Usr_11238);
static N_INLINE(NI, Atomicinc_3001)(NI* Memloc_3004, NI X_3005);
static N_INLINE(NI, Atomicdec_3006)(NI* Memloc_3009, NI X_3010);
static N_INLINE(void, Rtladdzct_11858)(TY10802* C_11860);
N_NOINLINE(void, Addzct_11225)(TY10818* S_11228, TY10802* C_11229);
N_NIMCALL(NimStringDesc*, copyString)(NimStringDesc* Src_17508);
static N_INLINE(NI, addInt)(NI A_5803, NI B_5804);
N_NIMCALL(NI, nospexecProcesses)(NimStringDesc** Cmds_66689, NI Cmds_66689Len0, NU8 Options_66691, NI N_66692);
N_NIMCALL(void, internalAssert)(NCSTRING File_5254, NI Line_5255, NIM_BOOL Cond_5256);
N_NIMCALL(void, nossleep)(NI Milsecs_41406);
N_NIMCALL(NimStringDesc*, nospexecProcess)(NimStringDesc* Command_66218, NU8 Options_66221);
N_NIMCALL(NimStringDesc*, Readline_65210)(TY65027* S_65212);
static N_INLINE(void, appendString)(NimStringDesc* Dest_17592, NimStringDesc* Src_17593);
N_NIMCALL(NimStringDesc*, resizeString)(NimStringDesc* Dest_17582, NI Addlen_17583);
N_NIMCALL(NimStringDesc*, Addcmdargs_67203)(NimStringDesc* Command_67205, NimStringDesc** Args_67207, NI Args_67207Len0);
N_NIMCALL(NimStringDesc*, Quoteifcontainswhite_25283)(NimStringDesc* S_25285);
N_NIMCALL(NCSTRING*, Tocstringarray_67217)(NimStringDesc** B_67220, NI B_67220Len0, NimStringDesc** A_67221, NI A_67221Len0);
N_NOCONV(void*, Alloc0_1953)(NI Size_1955);
N_NIMCALL(NI, mulInt)(NI A_6803, NI B_6804);
N_NOCONV(void*, Alloc_1950)(NI Size_1952);
N_NIMCALL(NCSTRING*, Tocstringarray_67287)(TY64408* T_67289);
N_NIMCALL(NI, nstlen)(TY64408* T_64421);
N_NIMCALL(NimStringDesc*, rawNewString)(NI Space_17487);
N_NIMCALL(TY66202*, nospstartProcess)(NimStringDesc* Command_66238, NimStringDesc* Workingdir_66239, NimStringDesc** Args_66244, NI Args_66244Len0, TY64408* Env_66245, NU8 Options_66248);
N_NIMCALL(void*, newObj)(TNimType* Typ_12507, NI Size_12508);
N_NOINLINE(void, nosOSError)(NimStringDesc* Msg_35604);
static N_INLINE(void, Setcurrentdir_37201)(NimStringDesc* Newdir_37203);
N_NIMCALL(NimStringDesc*, nosextractFilename)(NimStringDesc* Path_37785);
N_NIMCALL(void, Quit_2822)(NimStringDesc* Errormsg_2824);
N_NIMCALL(NimStringDesc*, cstrToNimstr)(NCSTRING Str_17504);
N_NIMCALL(NimStringDesc*, nsuJoinSep)(NimStringDesc** A_25004, NI A_25004Len0, NimStringDesc* Sep_25005);
static N_INLINE(void, rawEcho)(NimStringDesc* X_4094);
N_NIMCALL(void, Write_3658)(FILE* F_3660, NimStringDesc* S_3661);
static N_INLINE(void, rawEchoNL)(void);
static N_INLINE(NI, chckRange)(NI I_4610, NI A_4611, NI B_4612);
N_NOINLINE(void, raiseRangeError)(NI64 Val_5418);
N_NIMCALL(void, nospsuspend)(TY66202* P_66251);
N_NIMCALL(void, nospresume)(TY66202* P_66254);
N_NIMCALL(NIM_BOOL, nosprunning)(TY66202* P_66260);
N_NIMCALL(void, nospterminate)(TY66202* P_66257);
N_NIMCALL(NI, nospwaitForExit)(TY66202* P_66267);
N_NIMCALL(TY65027*, nospinputStream)(TY66202* P_66270);
N_NIMCALL(NIM_BOOL, Open_3624)(FILE** F_3627, int Filehandle_3628, NU8 Mode_3629);
N_NIMCALL(TY65323*, Newfilestream_65354)(FILE* F_65356);
N_NIMCALL(TY65027*, nospoutputStream)(TY66202* P_66273);
N_NIMCALL(TY65027*, nosperrorStream)(TY66202* P_66276);
N_NIMCALL(NI, nospexecCmd)(NimStringDesc* Command_66231);
STRING_LITERAL(TMP66685, "", 0);
STRING_LITERAL(TMP67002, "\012", 1);
STRING_LITERAL(TMP67631, " ", 1);
STRING_LITERAL(TMP67632, "=", 1);
STRING_LITERAL(TMP67633, "failed to create a pipe", 23);
STRING_LITERAL(TMP67634, "failed to fork process", 22);
STRING_LITERAL(TMP67636, "sh", 2);
STRING_LITERAL(TMP67637, "-c", 2);
NIM_CONST TY67430 TMP67635 = {((NimStringDesc*) &TMP67636),
((NimStringDesc*) &TMP67637)}
;
STRING_LITERAL(TMP67638, "execve call failed: ", 20);
extern TNimType* NTI4377; /* seq[string] */
extern TY11190 Gch_11210;
extern TNimType* NTI66698; /* seq[PProcess] */
extern TNimType* NTI66204; /* PProcess */
extern TNimType* NTI66202; /* TProcess */
N_NIMCALL(NimStringDesc*, Executeprocess_66222)(NimStringDesc* Command_66224, NU8 Options_66227) {
NimStringDesc* Result_66228;
volatile struct {TFrame* prev;NCSTRING procname;NI line;NCSTRING filename;NI len;
} F;
F.procname = "executeProcess";
F.prev = framePtr;
F.filename = "/home/andreas/projects/nimrod/lib/pure/osproc.nim";
F.line = 0;
framePtr = (TFrame*)&F;
F.len = 0;
Result_66228 = 0;
F.line = 54;F.filename = "osproc.nim";
Result_66228 = nospexecProcess(Command_66224, Options_66227);
framePtr = framePtr->prev;
return Result_66228;
}
N_NIMCALL(NI, Executecommand_66232)(NimStringDesc* Command_66234) {
NI Result_66235;
volatile struct {TFrame* prev;NCSTRING procname;NI line;NCSTRING filename;NI len;
} F;
F.procname = "executeCommand";
F.prev = framePtr;
F.filename = "/home/andreas/projects/nimrod/lib/pure/osproc.nim";
F.line = 0;
framePtr = (TFrame*)&F;
F.len = 0;
Result_66235 = 0;
F.line = 62;F.filename = "osproc.nim";
Result_66235 = nospexecCmd(Command_66234);
framePtr = framePtr->prev;
return Result_66235;
}
N_NIMCALL(NI, nospprocessID)(TY66202* P_66263) {
NI Result_66264;
volatile struct {TFrame* prev;NCSTRING procname;NI line;NCSTRING filename;NI len;
} F;
F.procname = "processID";
F.prev = framePtr;
F.filename = "/home/andreas/projects/nimrod/lib/pure/osproc.nim";
F.line = 0;
framePtr = (TFrame*)&F;
F.len = 0;
Result_66264 = 0;
F.line = 99;F.filename = "osproc.nim";
F.line = 99;F.filename = "osproc.nim";
Result_66264 = ((NI) ((*P_66263).Id));
goto BeforeRet;
BeforeRet: ;
framePtr = framePtr->prev;
return Result_66264;
}
N_NIMCALL(NI, nospcountProcessors)(void) {
NI Result_66403;
TY66404 Mib_66406;
NI Len_66407;
NI Numcpu_66408;
int LOC1;
int LOC5;
volatile struct {TFrame* prev;NCSTRING procname;NI line;NCSTRING filename;NI len;
} F;
F.procname = "countProcessors";
F.prev = framePtr;
F.filename = "/home/andreas/projects/nimrod/lib/pure/osproc.nim";
F.line = 0;
framePtr = (TFrame*)&F;
F.len = 0;
Result_66403 = 0;
memset((void*)&Mib_66406, 0, sizeof(Mib_66406));
Len_66407 = 0;
Numcpu_66408 = 0;
F.line = 132;F.filename = "osproc.nim";
Mib_66406[(0)-0] = ((NI32) 6);
F.line = 133;F.filename = "osproc.nim";
Mib_66406[(1)-0] = ((NI32) 25);
F.line = 134;F.filename = "osproc.nim";
Len_66407 = 8;
F.line = 135;F.filename = "osproc.nim";
LOC1 = sysctl(Mib_66406, ((NI32) 2), ((void*) (&Numcpu_66408)), &Len_66407, NIM_NIL, 0);
F.line = 136;F.filename = "osproc.nim";
if (!(Numcpu_66408 < 1)) goto LA3;
F.line = 137;F.filename = "osproc.nim";
Mib_66406[(1)-0] = ((NI32) 3);
F.line = 138;F.filename = "osproc.nim";
LOC5 = sysctl(Mib_66406, ((NI32) 2), ((void*) (&Numcpu_66408)), &Len_66407, NIM_NIL, 0);
LA3: ;
F.line = 139;F.filename = "osproc.nim";
Result_66403 = Numcpu_66408;
F.line = 147;F.filename = "osproc.nim";
if (!(Result_66403 <= 0)) goto LA7;
F.line = 147;F.filename = "osproc.nim";
Result_66403 = 1;
LA7: ;
framePtr = framePtr->prev;
return Result_66403;
}
static N_INLINE(NI, subInt)(NI A_6003, NI B_6004) {
NI Result_6005;
NIM_BOOL LOC2;
Result_6005 = 0;
Result_6005 = (NI64)((NU64)(A_6003) - (NU64)(B_6004));
LOC2 = (0 <= (NI64)(Result_6005 ^ A_6003));
if (LOC2) goto LA3;
LOC2 = (0 <= (NI64)(Result_6005 ^ (NI64)((NU64) ~(B_6004))));
LA3: ;
if (!LOC2) goto LA4;
goto BeforeRet;
LA4: ;
raiseOverflow();
BeforeRet: ;
return Result_6005;
}
static N_INLINE(TY10802*, Usrtocell_11236)(void* Usr_11238) {
TY10802* Result_11239;
volatile struct {TFrame* prev;NCSTRING procname;NI line;NCSTRING filename;NI len;
} F;
F.procname = "usrToCell";
F.prev = framePtr;
F.filename = "/home/andreas/projects/nimrod/lib/system/gc.nim";
F.line = 0;
framePtr = (TFrame*)&F;
F.len = 0;
Result_11239 = 0;
F.line = 100;F.filename = "gc.nim";
Result_11239 = ((TY10802*) ((NI64)((NU64)(((NI) (Usr_11238))) - (NU64)(((NI) (((NI)sizeof(TY10802))))))));
framePtr = framePtr->prev;
return Result_11239;
}
static N_INLINE(NI, Atomicinc_3001)(NI* Memloc_3004, NI X_3005) {
NI Result_7408;
volatile struct {TFrame* prev;NCSTRING procname;NI line;NCSTRING filename;NI len;
} F;
F.procname = "atomicInc";
F.prev = framePtr;
F.filename = "/home/andreas/projects/nimrod/lib/system/systhread.nim";
F.line = 0;
framePtr = (TFrame*)&F;
F.len = 0;
Result_7408 = 0;
F.line = 29;F.filename = "systhread.nim";
Result_7408 = __sync_add_and_fetch(Memloc_3004, X_3005);
framePtr = framePtr->prev;
return Result_7408;
}
static N_INLINE(NI, Atomicdec_3006)(NI* Memloc_3009, NI X_3010) {
NI Result_7606;
volatile struct {TFrame* prev;NCSTRING procname;NI line;NCSTRING filename;NI len;
} F;
F.procname = "atomicDec";
F.prev = framePtr;
F.filename = "/home/andreas/projects/nimrod/lib/system/systhread.nim";
F.line = 0;
framePtr = (TFrame*)&F;
F.len = 0;
Result_7606 = 0;
F.line = 37;F.filename = "systhread.nim";
Result_7606 = __sync_sub_and_fetch(Memloc_3009, X_3010);
framePtr = framePtr->prev;
return Result_7606;
}
static N_INLINE(void, Rtladdzct_11858)(TY10802* C_11860) {
volatile struct {TFrame* prev;NCSTRING procname;NI line;NCSTRING filename;NI len;
} F;
F.procname = "rtlAddZCT";
F.prev = framePtr;
F.filename = "/home/andreas/projects/nimrod/lib/system/gc.nim";
F.line = 0;
framePtr = (TFrame*)&F;
F.len = 0;
F.line = 211;F.filename = "gc.nim";
if (!NIM_TRUE) goto LA2;
F.line = 211;F.filename = "gc.nim";
pthread_mutex_lock(&Gch_11210.Zctlock);
LA2: ;
F.line = 212;F.filename = "gc.nim";
Addzct_11225(&Gch_11210.Zct, C_11860);
F.line = 213;F.filename = "gc.nim";
if (!NIM_TRUE) goto LA5;
F.line = 213;F.filename = "gc.nim";
pthread_mutex_unlock(&Gch_11210.Zctlock);
LA5: ;
framePtr = framePtr->prev;
}
static N_INLINE(void, asgnRefNoCycle)(void** Dest_12018, void* Src_12019) {
TY10802* C_12020;
NI LOC4;
TY10802* C_12022;
NI LOC9;
volatile struct {TFrame* prev;NCSTRING procname;NI line;NCSTRING filename;NI len;
} F;
F.procname = "asgnRefNoCycle";
F.prev = framePtr;
F.filename = "/home/andreas/projects/nimrod/lib/system/gc.nim";
F.line = 0;
framePtr = (TFrame*)&F;
F.len = 0;
F.line = 244;F.filename = "gc.nim";
if (!!((Src_12019 == NIM_NIL))) goto LA2;
C_12020 = 0;
F.line = 245;F.filename = "gc.nim";
C_12020 = Usrtocell_11236(Src_12019);
F.line = 246;F.filename = "gc.nim";
LOC4 = Atomicinc_3001(&(*C_12020).Refcount, 8);
LA2: ;
F.line = 247;F.filename = "gc.nim";
if (!!(((*Dest_12018) == NIM_NIL))) goto LA6;
C_12022 = 0;
F.line = 248;F.filename = "gc.nim";
C_12022 = Usrtocell_11236((*Dest_12018));
F.line = 249;F.filename = "gc.nim";
LOC9 = Atomicdec_3006(&(*C_12022).Refcount, 8);
if (!((NU64)(LOC9) < (NU64)(8))) goto LA10;
F.line = 250;F.filename = "gc.nim";
Rtladdzct_11858(C_12022);
LA10: ;
LA6: ;
F.line = 251;F.filename = "gc.nim";
(*Dest_12018) = Src_12019;
framePtr = framePtr->prev;
}
static N_INLINE(NI, addInt)(NI A_5803, NI B_5804) {
NI Result_5805;
NIM_BOOL LOC2;
Result_5805 = 0;
Result_5805 = (NI64)((NU64)(A_5803) + (NU64)(B_5804));
LOC2 = (0 <= (NI64)(Result_5805 ^ A_5803));
if (LOC2) goto LA3;
LOC2 = (0 <= (NI64)(Result_5805 ^ B_5804));
LA3: ;
if (!LOC2) goto LA4;
goto BeforeRet;
LA4: ;
raiseOverflow();
BeforeRet: ;
return Result_5805;
}
N_NIMCALL(TY66202*, Startprocessaux_66603)(NimStringDesc* Cmd_66605, NU8 Options_66607) {
TY66202* Result_66608;
TY4377* C_66609;
TY4377* A_66627;
NI I_66660;
NI HEX3Atmp_66680;
NI Res_66682;
volatile struct {TFrame* prev;NCSTRING procname;NI line;NCSTRING filename;NI len;
} F;
F.procname = "startProcessAux";
F.prev = framePtr;
F.filename = "/home/andreas/projects/nimrod/lib/pure/osproc.nim";
F.line = 0;
framePtr = (TFrame*)&F;
F.len = 0;
Result_66608 = 0;
C_66609 = 0;
F.line = 150;F.filename = "osproc.nim";
C_66609 = nosparseCmdLine(Cmd_66605);
A_66627 = 0;
F.line = 151;F.filename = "osproc.nim";
A_66627 = (TY4377*) newSeq(NTI4377, 0);
I_66660 = 0;
HEX3Atmp_66680 = 0;
F.line = 152;F.filename = "osproc.nim";
HEX3Atmp_66680 = subInt(C_66609->Sup.len, 1);
Res_66682 = 0;
F.line = 1021;F.filename = "system.nim";
Res_66682 = 1;
F.line = 1022;F.filename = "system.nim";
while (1) {
if (!(Res_66682 <= HEX3Atmp_66680)) goto LA1;
F.line = 1021;F.filename = "system.nim";
I_66660 = Res_66682;
F.line = 152;F.filename = "osproc.nim";
if ((NU)(I_66660) >= (NU)(C_66609->Sup.len)) raiseIndexError();
A_66627 = (TY4377*) incrSeq(&(A_66627)->Sup, sizeof(NimStringDesc*));
asgnRefNoCycle((void**) &A_66627->data[A_66627->Sup.len-1], copyString(C_66609->data[I_66660]));
F.line = 1024;F.filename = "system.nim";
Res_66682 = addInt(Res_66682, 1);
} LA1: ;
F.line = 153;F.filename = "osproc.nim";
if ((NU)(0) >= (NU)(C_66609->Sup.len)) raiseIndexError();
Result_66608 = nospstartProcess(C_66609->data[0], ((NimStringDesc*) &TMP66685), A_66627->data, A_66627->Sup.len, NIM_NIL, Options_66607);
framePtr = framePtr->prev;
return Result_66608;
}
N_NIMCALL(NI, nospexecProcesses)(NimStringDesc** Cmds_66689, NI Cmds_66689Len0, NU8 Options_66691, NI N_66692) {
NI Result_66693;
TY66698* Q_66699;
NI M_66724;
NI I_66732;
NI HEX3Atmp_66823;
NI Res_66825;
NI I_66733;
NI R_66743;
NI HEX3Atmp_66829;
NI Res_66831;
NIM_BOOL LOC8;
NI LOC11;
NI I_66808;
NI HEX3Atmp_66836;
NI Res_66838;
NI LOC16;
NI I_66818;
NI HEX3Atmp_66842;
NI Res_66844;
TY66202* P_66819;
NI LOC18;
volatile struct {TFrame* prev;NCSTRING procname;NI line;NCSTRING filename;NI len;
} F;
F.procname = "execProcesses";
F.prev = framePtr;
F.filename = "/home/andreas/projects/nimrod/lib/pure/osproc.nim";
F.line = 0;
framePtr = (TFrame*)&F;
F.len = 0;
Result_66693 = 0;
F.line = 161;F.filename = "osproc.nim";
internalAssert("/home/andreas/projects/nimrod/lib/pure/osproc.nim", 161, (0 < N_66692));
F.line = 162;F.filename = "osproc.nim";
if (!(1 < N_66692)) goto LA2;
Q_66699 = 0;
F.line = 164;F.filename = "osproc.nim";
Q_66699 = (TY66698*) newSeq(NTI66698, N_66692);
M_66724 = 0;
F.line = 165;F.filename = "osproc.nim";
M_66724 = ((N_66692 <= Cmds_66689Len0) ? N_66692 : Cmds_66689Len0);
I_66732 = 0;
HEX3Atmp_66823 = 0;
F.line = 166;F.filename = "osproc.nim";
HEX3Atmp_66823 = subInt(M_66724, 1);
Res_66825 = 0;
F.line = 1021;F.filename = "system.nim";
Res_66825 = 0;
F.line = 1022;F.filename = "system.nim";
while (1) {
if (!(Res_66825 <= HEX3Atmp_66823)) goto LA4;
F.line = 1021;F.filename = "system.nim";
I_66732 = Res_66825;
F.line = 167;F.filename = "osproc.nim";
if ((NU)(I_66732) >= (NU)(Q_66699->Sup.len)) raiseIndexError();
if ((NU)(I_66732) >= (NU)(Cmds_66689Len0)) raiseIndexError();
asgnRefNoCycle((void**) &Q_66699->data[I_66732], Startprocessaux_66603(Cmds_66689[I_66732], Options_66691));
F.line = 1024;F.filename = "system.nim";
Res_66825 = addInt(Res_66825, 1);
} LA4: ;
I_66733 = 0;
F.line = 182;F.filename = "osproc.nim";
I_66733 = M_66724;
F.line = 183;F.filename = "osproc.nim";
while (1) {
if (!(I_66733 <= (Cmds_66689Len0-1))) goto LA5;
F.line = 184;F.filename = "osproc.nim";
nossleep(50);
R_66743 = 0;
HEX3Atmp_66829 = 0;
F.line = 185;F.filename = "osproc.nim";
HEX3Atmp_66829 = subInt(N_66692, 1);
Res_66831 = 0;
F.line = 1021;F.filename = "system.nim";
Res_66831 = 0;
F.line = 1022;F.filename = "system.nim";
while (1) {
if (!(Res_66831 <= HEX3Atmp_66829)) goto LA6;
F.line = 1021;F.filename = "system.nim";
R_66743 = Res_66831;
F.line = 186;F.filename = "osproc.nim";
if ((NU)(R_66743) >= (NU)(Q_66699->Sup.len)) raiseIndexError();
LOC8 = nosprunning(Q_66699->data[R_66743]);
if (!!(LOC8)) goto LA9;
F.line = 188;F.filename = "osproc.nim";
if ((NU)(R_66743) >= (NU)(Q_66699->Sup.len)) raiseIndexError();
LOC11 = nospwaitForExit(Q_66699->data[R_66743]);
Result_66693 = ((LOC11 >= Result_66693) ? LOC11 : Result_66693);
F.line = 189;F.filename = "osproc.nim";
if ((NU)(R_66743) >= (NU)(Q_66699->Sup.len)) raiseIndexError();
if ((NU)(I_66733) >= (NU)(Cmds_66689Len0)) raiseIndexError();
asgnRefNoCycle((void**) &Q_66699->data[R_66743], Startprocessaux_66603(Cmds_66689[I_66733], Options_66691));
F.line = 190;F.filename = "osproc.nim";
I_66733 = addInt(I_66733, 1);
F.line = 191;F.filename = "osproc.nim";
if (!((Cmds_66689Len0-1) < I_66733)) goto LA13;
F.line = 191;F.filename = "osproc.nim";
goto LA6;
LA13: ;
LA9: ;
F.line = 1024;F.filename = "system.nim";
Res_66831 = addInt(Res_66831, 1);
} LA6: ;
} LA5: ;
I_66808 = 0;
HEX3Atmp_66836 = 0;
F.line = 192;F.filename = "osproc.nim";
HEX3Atmp_66836 = subInt(M_66724, 1);
Res_66838 = 0;
F.line = 1021;F.filename = "system.nim";
Res_66838 = 0;
F.line = 1022;F.filename = "system.nim";
while (1) {
if (!(Res_66838 <= HEX3Atmp_66836)) goto LA15;
F.line = 1021;F.filename = "system.nim";
I_66808 = Res_66838;
F.line = 193;F.filename = "osproc.nim";
if ((NU)(I_66808) >= (NU)(Q_66699->Sup.len)) raiseIndexError();
LOC16 = nospwaitForExit(Q_66699->data[I_66808]);
Result_66693 = ((LOC16 >= Result_66693) ? LOC16 : Result_66693);
F.line = 1024;F.filename = "system.nim";
Res_66838 = addInt(Res_66838, 1);
} LA15: ;
goto LA1;
LA2: ;
I_66818 = 0;
HEX3Atmp_66842 = 0;
F.line = 195;F.filename = "osproc.nim";
HEX3Atmp_66842 = (Cmds_66689Len0-1);
Res_66844 = 0;
F.line = 1021;F.filename = "system.nim";
Res_66844 = 0;
F.line = 1022;F.filename = "system.nim";
while (1) {
if (!(Res_66844 <= HEX3Atmp_66842)) goto LA17;
F.line = 1021;F.filename = "system.nim";
I_66818 = Res_66844;
P_66819 = 0;
F.line = 196;F.filename = "osproc.nim";
if ((NU)(I_66818) >= (NU)(Cmds_66689Len0)) raiseIndexError();
P_66819 = Startprocessaux_66603(Cmds_66689[I_66818], Options_66691);
F.line = 197;F.filename = "osproc.nim";
LOC18 = nospwaitForExit(P_66819);
Result_66693 = ((LOC18 >= Result_66693) ? LOC18 : Result_66693);
F.line = 1024;F.filename = "system.nim";
Res_66844 = addInt(Res_66844, 1);
} LA17: ;
LA1: ;
framePtr = framePtr->prev;
return Result_66693;
}
static N_INLINE(void, appendString)(NimStringDesc* Dest_17592, NimStringDesc* Src_17593) {
volatile struct {TFrame* prev;NCSTRING procname;NI line;NCSTRING filename;NI len;
} F;
F.procname = "appendString";
F.prev = framePtr;
F.filename = "/home/andreas/projects/nimrod/lib/system/sysstr.nim";
F.line = 0;
framePtr = (TFrame*)&F;
F.len = 0;
F.line = 150;F.filename = "sysstr.nim";
memcpy(((NCSTRING) (&(*Dest_17592).data[((*Dest_17592).Sup.len)-0])), ((NCSTRING) ((*Src_17593).data)), ((int) ((NI64)((NI64)((*Src_17593).Sup.len + 1) * 1))));
F.line = 151;F.filename = "sysstr.nim";
(*Dest_17592).Sup.len += (*Src_17593).Sup.len;
framePtr = framePtr->prev;
}
N_NIMCALL(NimStringDesc*, nospexecProcess)(NimStringDesc* Command_66218, NU8 Options_66221) {
NimStringDesc* Result_66854;
TY66202* P_66855;
TY65027* Outp_66856;
NIM_BOOL LOC2;
NIM_BOOL LOC4;
NimStringDesc* LOC5;
volatile struct {TFrame* prev;NCSTRING procname;NI line;NCSTRING filename;NI len;
} F;
F.procname = "execProcess";
F.prev = framePtr;
F.filename = "/home/andreas/projects/nimrod/lib/pure/osproc.nim";
F.line = 0;
framePtr = (TFrame*)&F;
F.len = 0;
Result_66854 = 0;
P_66855 = 0;
F.line = 203;F.filename = "osproc.nim";
P_66855 = Startprocessaux_66603(Command_66218, Options_66221);
Outp_66856 = 0;
F.line = 204;F.filename = "osproc.nim";
Outp_66856 = nospoutputStream(P_66855);
F.line = 205;F.filename = "osproc.nim";
Result_66854 = copyString(((NimStringDesc*) &TMP66685));
F.line = 206;F.filename = "osproc.nim";
while (1) {
LOC2 = nosprunning(P_66855);
if (LOC2) goto LA3;
LOC4 = (*Outp_66856).Atend(Outp_66856);
LOC2 = !(LOC4);
LA3: ;
if (!LOC2) goto LA1;
F.line = 207;F.filename = "osproc.nim";
LOC5 = 0;
LOC5 = Readline_65210(Outp_66856);
Result_66854 = resizeString(Result_66854, LOC5->Sup.len + 0);
appendString(Result_66854, LOC5);
F.line = 208;F.filename = "osproc.nim";
Result_66854 = resizeString(Result_66854, 1);
appendString(Result_66854, ((NimStringDesc*) &TMP67002));
} LA1: ;
framePtr = framePtr->prev;
return Result_66854;
}
N_NIMCALL(NimStringDesc*, Addcmdargs_67203)(NimStringDesc* Command_67205, NimStringDesc** Args_67207, NI Args_67207Len0) {
NimStringDesc* Result_67208;
NI I_67216;
NI HEX3Atmp_67602;
NI Res_67604;
NimStringDesc* LOC2;
volatile struct {TFrame* prev;NCSTRING procname;NI line;NCSTRING filename;NI len;
} F;
F.procname = "addCmdArgs";
F.prev = framePtr;
F.filename = "/home/andreas/projects/nimrod/lib/pure/osproc.nim";
F.line = 0;
framePtr = (TFrame*)&F;
F.len = 0;
Result_67208 = 0;
F.line = 407;F.filename = "osproc.nim";
Result_67208 = Quoteifcontainswhite_25283(Command_67205);
I_67216 = 0;
HEX3Atmp_67602 = 0;
F.line = 408;F.filename = "osproc.nim";
HEX3Atmp_67602 = (Args_67207Len0-1);
Res_67604 = 0;
F.line = 1021;F.filename = "system.nim";
Res_67604 = 0;
F.line = 1022;F.filename = "system.nim";
while (1) {
if (!(Res_67604 <= HEX3Atmp_67602)) goto LA1;
F.line = 1021;F.filename = "system.nim";
I_67216 = Res_67604;
F.line = 409;F.filename = "osproc.nim";
Result_67208 = resizeString(Result_67208, 1);
appendString(Result_67208, ((NimStringDesc*) &TMP67631));
F.line = 410;F.filename = "osproc.nim";
if ((NU)(I_67216) >= (NU)(Args_67207Len0)) raiseIndexError();
LOC2 = 0;
LOC2 = Quoteifcontainswhite_25283(Args_67207[I_67216]);
Result_67208 = resizeString(Result_67208, LOC2->Sup.len + 0);
appendString(Result_67208, LOC2);
F.line = 1024;F.filename = "system.nim";
Res_67604 = addInt(Res_67604, 1);
} LA1: ;
framePtr = framePtr->prev;
return Result_67208;
}
N_NIMCALL(NCSTRING*, Tocstringarray_67217)(NimStringDesc** B_67220, NI B_67220Len0, NimStringDesc** A_67221, NI A_67221Len0) {
NCSTRING* Result_67222;
void* LOC1;
NI I_67250;
NI HEX3Atmp_67608;
NI Res_67610;
void* LOC3;
NI I_67262;
NI HEX3Atmp_67614;
NI Res_67616;
void* LOC5;
volatile struct {TFrame* prev;NCSTRING procname;NI line;NCSTRING filename;NI len;
} F;
F.procname = "toCStringArray";
F.prev = framePtr;
F.filename = "/home/andreas/projects/nimrod/lib/pure/osproc.nim";
F.line = 0;
framePtr = (TFrame*)&F;
F.len = 0;
Result_67222 = 0;
F.line = 413;F.filename = "osproc.nim";
LOC1 = Alloc0_1953(mulInt(addInt(addInt(A_67221Len0, B_67220Len0), 1), 8));
Result_67222 = ((NCSTRING*) (LOC1));
I_67250 = 0;
HEX3Atmp_67608 = 0;
F.line = 414;F.filename = "osproc.nim";
HEX3Atmp_67608 = (B_67220Len0-1);
Res_67610 = 0;
F.line = 1021;F.filename = "system.nim";
Res_67610 = 0;
F.line = 1022;F.filename = "system.nim";
while (1) {
if (!(Res_67610 <= HEX3Atmp_67608)) goto LA2;
F.line = 1021;F.filename = "system.nim";
I_67250 = Res_67610;
F.line = 415;F.filename = "osproc.nim";
if ((NU)(I_67250) > (NU)(50000)) raiseIndexError();
if ((NU)(I_67250) >= (NU)(B_67220Len0)) raiseIndexError();
LOC3 = Alloc_1950(addInt(B_67220[I_67250]->Sup.len, 1));
Result_67222[(I_67250)-0] = ((NCSTRING) (LOC3));
F.line = 416;F.filename = "osproc.nim";
if ((NU)(I_67250) > (NU)(50000)) raiseIndexError();
if ((NU)(I_67250) >= (NU)(B_67220Len0)) raiseIndexError();
if ((NU)(I_67250) >= (NU)(B_67220Len0)) raiseIndexError();
memcpy(((void*) (Result_67222[(I_67250)-0])), ((void*) (B_67220[I_67250]->data)), addInt(B_67220[I_67250]->Sup.len, 1));
F.line = 1024;F.filename = "system.nim";
Res_67610 = addInt(Res_67610, 1);
} LA2: ;
I_67262 = 0;
HEX3Atmp_67614 = 0;
F.line = 417;F.filename = "osproc.nim";
HEX3Atmp_67614 = (A_67221Len0-1);
Res_67616 = 0;
F.line = 1021;F.filename = "system.nim";
Res_67616 = 0;
F.line = 1022;F.filename = "system.nim";
while (1) {
if (!(Res_67616 <= HEX3Atmp_67614)) goto LA4;
F.line = 1021;F.filename = "system.nim";
I_67262 = Res_67616;
F.line = 418;F.filename = "osproc.nim";
if ((NU)(addInt(I_67262, B_67220Len0)) > (NU)(50000)) raiseIndexError();
if ((NU)(I_67262) >= (NU)(A_67221Len0)) raiseIndexError();
LOC5 = Alloc_1950(addInt(A_67221[I_67262]->Sup.len, 1));
Result_67222[(addInt(I_67262, B_67220Len0))-0] = ((NCSTRING) (LOC5));
F.line = 419;F.filename = "osproc.nim";
if ((NU)(addInt(I_67262, B_67220Len0)) > (NU)(50000)) raiseIndexError();
if ((NU)(I_67262) >= (NU)(A_67221Len0)) raiseIndexError();
if ((NU)(I_67262) >= (NU)(A_67221Len0)) raiseIndexError();
memcpy(((void*) (Result_67222[(addInt(I_67262, B_67220Len0))-0])), ((void*) (A_67221[I_67262]->data)), addInt(A_67221[I_67262]->Sup.len, 1));
F.line = 1024;F.filename = "system.nim";
Res_67616 = addInt(Res_67616, 1);
} LA4: ;
framePtr = framePtr->prev;
return Result_67222;
}
N_NIMCALL(NCSTRING*, Tocstringarray_67287)(TY64408* T_67289) {
NCSTRING* Result_67290;
NI LOC1;
void* LOC2;
NI I_67293;
NimStringDesc* Key_67294;
NimStringDesc* Val_67295;
NI H_67621;
NI HEX3Atmp_67623;
NI Res_67625;
NimStringDesc* X_67312;
NimStringDesc* LOC7;
void* LOC8;
volatile struct {TFrame* prev;NCSTRING procname;NI line;NCSTRING filename;NI len;
} F;
F.procname = "ToCStringArray";
F.prev = framePtr;
F.filename = "/home/andreas/projects/nimrod/lib/pure/osproc.nim";
F.line = 0;
framePtr = (TFrame*)&F;
F.len = 0;
Result_67290 = 0;
F.line = 422;F.filename = "osproc.nim";
LOC1 = nstlen(T_67289);
LOC2 = Alloc0_1953(mulInt(addInt(LOC1, 1), 8));
Result_67290 = ((NCSTRING*) (LOC2));
I_67293 = 0;
F.line = 423;F.filename = "osproc.nim";
I_67293 = 0;
Key_67294 = 0;
Val_67295 = 0;
H_67621 = 0;
HEX3Atmp_67623 = 0;
F.line = 40;F.filename = "strtabs.nim";
HEX3Atmp_67623 = ((*T_67289).Data->Sup.len-1);
Res_67625 = 0;
F.line = 1021;F.filename = "system.nim";
Res_67625 = 0;
F.line = 1022;F.filename = "system.nim";
while (1) {
if (!(Res_67625 <= HEX3Atmp_67623)) goto LA3;
F.line = 1021;F.filename = "system.nim";
H_67621 = Res_67625;
F.line = 41;F.filename = "strtabs.nim";
if ((NU)(H_67621) >= (NU)((*T_67289).Data->Sup.len)) raiseIndexError();
if (!!((*T_67289).Data->data[H_67621].Key == 0)) goto LA5;
F.line = 42;F.filename = "strtabs.nim";
if ((NU)(H_67621) >= (NU)((*T_67289).Data->Sup.len)) raiseIndexError();
Key_67294 = (*T_67289).Data->data[H_67621].Key;
F.line = 42;F.filename = "strtabs.nim";
if ((NU)(H_67621) >= (NU)((*T_67289).Data->Sup.len)) raiseIndexError();
Val_67295 = (*T_67289).Data->data[H_67621].Val;
X_67312 = 0;
F.line = 425;F.filename = "osproc.nim";
LOC7 = 0;
LOC7 = rawNewString(Key_67294->Sup.len + Val_67295->Sup.len + 1);
appendString(LOC7, Key_67294);
appendString(LOC7, ((NimStringDesc*) &TMP67632));
appendString(LOC7, Val_67295);
X_67312 = LOC7;
F.line = 426;F.filename = "osproc.nim";
if ((NU)(I_67293) > (NU)(50000)) raiseIndexError();
LOC8 = Alloc_1950(addInt(X_67312->Sup.len, 1));
Result_67290[(I_67293)-0] = ((NCSTRING) (LOC8));
F.line = 427;F.filename = "osproc.nim";
if ((NU)(I_67293) > (NU)(50000)) raiseIndexError();
if ((NU)(0) > (NU)(X_67312->Sup.len)) raiseIndexError();
memcpy(((void*) (Result_67290[(I_67293)-0])), ((void*) (&X_67312->data[0])), addInt(X_67312->Sup.len, 1));
F.line = 428;F.filename = "osproc.nim";
I_67293 = addInt(I_67293, 1);
LA5: ;
F.line = 1024;F.filename = "system.nim";
Res_67625 = addInt(Res_67625, 1);
} LA3: ;
framePtr = framePtr->prev;
return Result_67290;
}
static N_INLINE(void, Setcurrentdir_37201)(NimStringDesc* Newdir_37203) {
int LOC2;
volatile struct {TFrame* prev;NCSTRING procname;NI line;NCSTRING filename;NI len;
} F;
F.procname = "setCurrentDir";
F.prev = framePtr;
F.filename = "/home/andreas/projects/nimrod/lib/pure/os.nim";
F.line = 0;
framePtr = (TFrame*)&F;
F.len = 0;
F.line = 306;F.filename = "os.nim";
LOC2 = chdir(Newdir_37203->data);
if (!!((LOC2 == ((NI32) 0)))) goto LA3;
F.line = 306;F.filename = "os.nim";
nosOSError(((NimStringDesc*) &TMP66685));
LA3: ;
framePtr = framePtr->prev;
}
static N_INLINE(void, rawEcho)(NimStringDesc* X_4094) {
Write_3658(stdout, X_4094);
}
static N_INLINE(void, rawEchoNL)(void) {
Write_3658(stdout, ((NimStringDesc*) &TMP67002));
}
static N_INLINE(NI, chckRange)(NI I_4610, NI A_4611, NI B_4612) {
NI Result_5516;
NIM_BOOL LOC2;
Result_5516 = 0;
LOC2 = (A_4611 <= I_4610);
if (!(LOC2)) goto LA3;
LOC2 = (I_4610 <= B_4612);
LA3: ;
if (!LOC2) goto LA4;
Result_5516 = I_4610;
goto BeforeRet;
goto LA1;
LA4: ;
raiseRangeError(((NI64) (I_4610)));
LA1: ;
BeforeRet: ;
return Result_5516;
}
N_NIMCALL(TY66202*, nospstartProcess)(NimStringDesc* Command_66238, NimStringDesc* Workingdir_66239, NimStringDesc** Args_66244, NI Args_66244Len0, TY64408* Env_66245, NU8 Options_66248) {
TY66202* Result_67343;
TY67344 Pstdin_67346;
TY67344 Pstdout_67347;
TY67344 Pstderr_67348;
NIM_BOOL LOC2;
int LOC3;
int LOC5;
NI Pid_67368;
int LOC14;
int LOC16;
int LOC19;
int LOC21;
int LOC28;
int LOC32;
int LOC35;
int LOC37;
NCSTRING* A_67413;
TY46867 LOC46;
int LOC50;
NCSTRING* LOC51;
int LOC52;
NimStringDesc* X_67425;
NCSTRING* A_67434;
TY46867 LOC53;
int LOC57;
NCSTRING* LOC58;
int LOC59;
NimStringDesc* LOC60;
NCSTRING LOC61;
NimStringDesc* LOC62;
NimStringDesc* LOC66;
NimStringDesc* LOC67;
int LOC71;
int LOC72;
int LOC73;
volatile struct {TFrame* prev;NCSTRING procname;NI line;NCSTRING filename;NI len;
} F;
F.procname = "startProcess";
F.prev = framePtr;
F.filename = "/home/andreas/projects/nimrod/lib/pure/osproc.nim";
F.line = 0;
framePtr = (TFrame*)&F;
F.len = 0;
Result_67343 = 0;
memset((void*)&Pstdin_67346, 0, sizeof(Pstdin_67346));
memset((void*)&Pstdout_67347, 0, sizeof(Pstdout_67347));
memset((void*)&Pstderr_67348, 0, sizeof(Pstderr_67348));
F.line = 437;F.filename = "osproc.nim";
Result_67343 = (TY66202*) newObj(NTI66204, sizeof(TY66202));
(*Result_67343).Sup.m_type = NTI66202;
F.line = 438;F.filename = "osproc.nim";
(*Result_67343).Exitcode = ((NI32) 3);
F.line = 439;F.filename = "osproc.nim";
LOC3 = pipe(Pstdin_67346);
LOC2 = !((LOC3 == ((NI32) 0)));
if (LOC2) goto LA4;
LOC5 = pipe(Pstdout_67347);
LOC2 = !((LOC5 == ((NI32) 0)));
LA4: ;
if (!LOC2) goto LA6;
F.line = 440;F.filename = "osproc.nim";
nosOSError(((NimStringDesc*) &TMP67633));
LA6: ;
Pid_67368 = 0;
F.line = 441;F.filename = "osproc.nim";
Pid_67368 = fork();
F.line = 442;F.filename = "osproc.nim";
if (!(Pid_67368 < 0)) goto LA9;
F.line = 443;F.filename = "osproc.nim";
nosOSError(((NimStringDesc*) &TMP67634));
LA9: ;
F.line = 445;F.filename = "osproc.nim";
if (!(Pid_67368 == 0)) goto LA12;
F.line = 447;F.filename = "osproc.nim";
LOC14 = close(Pstdin_67346[(1)-0]);
F.line = 448;F.filename = "osproc.nim";
LOC16 = dup2(Pstdin_67346[(0)-0], ((NI32) 0));
if (!(((NI) (LOC16)) < 0)) goto LA17;
F.line = 448;F.filename = "osproc.nim";
nosOSError(((NimStringDesc*) &TMP66685));
LA17: ;
F.line = 449;F.filename = "osproc.nim";
LOC19 = close(Pstdout_67347[(0)-0]);
F.line = 450;F.filename = "osproc.nim";
LOC21 = dup2(Pstdout_67347[(1)-0], ((NI32) 1));
if (!(((NI) (LOC21)) < 0)) goto LA22;
F.line = 450;F.filename = "osproc.nim";
nosOSError(((NimStringDesc*) &TMP66685));
LA22: ;
F.line = 451;F.filename = "osproc.nim";
if (!((Options_66248 &(1<<((((NU8) 2))&7)))!=0)) goto LA25;
F.line = 452;F.filename = "osproc.nim";
LOC28 = dup2(Pstdout_67347[(1)-0], ((NI32) 2));
if (!(((NI) (LOC28)) < 0)) goto LA29;
F.line = 452;F.filename = "osproc.nim";
nosOSError(((NimStringDesc*) &TMP66685));
LA29: ;
goto LA24;
LA25: ;
F.line = 454;F.filename = "osproc.nim";
LOC32 = pipe(Pstderr_67348);
if (!!((LOC32 == ((NI32) 0)))) goto LA33;
F.line = 454;F.filename = "osproc.nim";
nosOSError(((NimStringDesc*) &TMP67633));
LA33: ;
F.line = 455;F.filename = "osproc.nim";
LOC35 = close(Pstderr_67348[(0)-0]);
F.line = 456;F.filename = "osproc.nim";
LOC37 = dup2(Pstderr_67348[(1)-0], ((NI32) 2));
if (!(((NI) (LOC37)) < 0)) goto LA38;
F.line = 456;F.filename = "osproc.nim";
nosOSError(((NimStringDesc*) &TMP66685));
LA38: ;
LA24: ;
F.line = 458;F.filename = "osproc.nim";
if (!(0 < Workingdir_66239->Sup.len)) goto LA41;
F.line = 459;F.filename = "osproc.nim";
Setcurrentdir_37201(Workingdir_66239);
LA41: ;
F.line = 460;F.filename = "osproc.nim";
if (!!(((Options_66248 &(1<<((((NU8) 1))&7)))!=0))) goto LA44;
A_67413 = 0;
F.line = 461;F.filename = "osproc.nim";
memset((void*)&LOC46, 0, sizeof(LOC46));
LOC46[0] = nosextractFilename(Command_66238);
A_67413 = Tocstringarray_67217(LOC46, 1, Args_66244, Args_66244Len0);
F.line = 462;F.filename = "osproc.nim";
if (!(Env_66245 == NIM_NIL)) goto LA48;
F.line = 463;F.filename = "osproc.nim";
LOC50 = execv(Command_66238->data, A_67413);
goto LA47;
LA48: ;
F.line = 465;F.filename = "osproc.nim";
LOC51 = Tocstringarray_67287(Env_66245);
LOC52 = execve(Command_66238->data, A_67413, LOC51);
LA47: ;
goto LA43;
LA44: ;
X_67425 = 0;
F.line = 467;F.filename = "osproc.nim";
X_67425 = Addcmdargs_67203(Command_66238, Args_66244, Args_66244Len0);
A_67434 = 0;
F.line = 468;F.filename = "osproc.nim";
memset((void*)&LOC53, 0, sizeof(LOC53));
LOC53[0] = copyString(X_67425);
A_67434 = Tocstringarray_67217(TMP67635, 2, LOC53, 1);
F.line = 469;F.filename = "osproc.nim";
if (!(Env_66245 == NIM_NIL)) goto LA55;
F.line = 470;F.filename = "osproc.nim";
LOC57 = execv("/bin/sh", A_67434);
goto LA54;
LA55: ;
F.line = 472;F.filename = "osproc.nim";
LOC58 = Tocstringarray_67287(Env_66245);
LOC59 = execve("/bin/sh", A_67434, LOC58);
LA54: ;
LA43: ;
F.line = 474;F.filename = "osproc.nim";
LOC60 = 0;
LOC61 = strerror(errno);
LOC62 = 0;
LOC62 = cstrToNimstr(LOC61);
LOC60 = rawNewString(LOC62->Sup.len + 20);
appendString(LOC60, ((NimStringDesc*) &TMP67638));
appendString(LOC60, LOC62);
Quit_2822(LOC60);
LA12: ;
F.line = 476;F.filename = "osproc.nim";
if (!((Options_66248 &(1<<((((NU8) 0))&7)))!=0)) goto LA64;
F.line = 477;F.filename = "osproc.nim";
LOC66 = 0;
LOC67 = 0;
LOC67 = nsuJoinSep(Args_66244, Args_66244Len0, ((NimStringDesc*) &TMP67631));
LOC66 = rawNewString(Command_66238->Sup.len + LOC67->Sup.len + 1);
appendString(LOC66, Command_66238);
appendString(LOC66, ((NimStringDesc*) &TMP67631));
appendString(LOC66, LOC67);
rawEcho(LOC66);
rawEchoNL();
LA64: ;
F.line = 478;F.filename = "osproc.nim";
(*Result_67343).Id = ((int)chckRange(Pid_67368, ((NI32) (-2147483647 -1)), ((NI32) 2147483647)));
F.line = 480;F.filename = "osproc.nim";
(*Result_67343).Inputhandle = Pstdin_67346[(1)-0];
F.line = 481;F.filename = "osproc.nim";
(*Result_67343).Outputhandle = Pstdout_67347[(0)-0];
F.line = 482;F.filename = "osproc.nim";
if (!((Options_66248 &(1<<((((NU8) 2))&7)))!=0)) goto LA69;
F.line = 483;F.filename = "osproc.nim";
(*Result_67343).Errorhandle = (*Result_67343).Outputhandle;
goto LA68;
LA69: ;
F.line = 485;F.filename = "osproc.nim";
(*Result_67343).Errorhandle = Pstderr_67348[(0)-0];
F.line = 486;F.filename = "osproc.nim";
LOC71 = close(Pstderr_67348[(1)-0]);
LA68: ;
F.line = 487;F.filename = "osproc.nim";
LOC72 = close(Pstdin_67346[(0)-0]);
F.line = 488;F.filename = "osproc.nim";
LOC73 = close(Pstdout_67347[(1)-0]);
framePtr = framePtr->prev;
return Result_67343;
}
N_NIMCALL(void, nospsuspend)(TY66202* P_66251) {
int LOC1;
volatile struct {TFrame* prev;NCSTRING procname;NI line;NCSTRING filename;NI len;
} F;
F.procname = "suspend";
F.prev = framePtr;
F.filename = "/home/andreas/projects/nimrod/lib/pure/osproc.nim";
F.line = 0;
framePtr = (TFrame*)&F;
F.len = 0;
F.line = 491;F.filename = "osproc.nim";
LOC1 = kill(((NI) ((*P_66251).Id)), SIGSTOP);
framePtr = framePtr->prev;
}
N_NIMCALL(void, nospresume)(TY66202* P_66254) {
int LOC1;
volatile struct {TFrame* prev;NCSTRING procname;NI line;NCSTRING filename;NI len;
} F;
F.procname = "resume";
F.prev = framePtr;
F.filename = "/home/andreas/projects/nimrod/lib/pure/osproc.nim";
F.line = 0;
framePtr = (TFrame*)&F;
F.len = 0;
F.line = 494;F.filename = "osproc.nim";
LOC1 = kill(((NI) ((*P_66254).Id)), SIGCONT);
framePtr = framePtr->prev;
}
N_NIMCALL(NIM_BOOL, nosprunning)(TY66202* P_66260) {
NIM_BOOL Result_67501;
NI LOC1;
volatile struct {TFrame* prev;NCSTRING procname;NI line;NCSTRING filename;NI len;
} F;
F.procname = "running";
F.prev = framePtr;
F.filename = "/home/andreas/projects/nimrod/lib/pure/osproc.nim";
F.line = 0;
framePtr = (TFrame*)&F;
F.len = 0;
Result_67501 = 0;
F.line = 497;F.filename = "osproc.nim";
LOC1 = waitpid(((NI) ((*P_66260).Id)), &(*P_66260).Exitcode, WNOHANG);
Result_67501 = (LOC1 == ((NI) ((*P_66260).Id)));
framePtr = framePtr->prev;
return Result_67501;
}
N_NIMCALL(void, nospterminate)(TY66202* P_66257) {
int LOC2;
NIM_BOOL LOC6;
int LOC9;
volatile struct {TFrame* prev;NCSTRING procname;NI line;NCSTRING filename;NI len;
} F;
F.procname = "terminate";
F.prev = framePtr;
F.filename = "/home/andreas/projects/nimrod/lib/pure/osproc.nim";
F.line = 0;
framePtr = (TFrame*)&F;
F.len = 0;
F.line = 500;F.filename = "osproc.nim";
LOC2 = kill(((NI) ((*P_66257).Id)), SIGTERM);
if (!(LOC2 == ((NI32) 0))) goto LA3;
F.line = 501;F.filename = "osproc.nim";
LOC6 = nosprunning(P_66257);
if (!LOC6) goto LA7;
F.line = 501;F.filename = "osproc.nim";
LOC9 = kill(((NI) ((*P_66257).Id)), SIGKILL);
LA7: ;
LA3: ;
framePtr = framePtr->prev;
}
N_NIMCALL(NI, nospwaitForExit)(TY66202* P_66267) {
NI Result_67513;
int Oldexitcode_67514;
NI LOC2;
volatile struct {TFrame* prev;NCSTRING procname;NI line;NCSTRING filename;NI len;
} F;
F.procname = "waitForExit";
F.prev = framePtr;
F.filename = "/home/andreas/projects/nimrod/lib/pure/osproc.nim";
F.line = 0;
framePtr = (TFrame*)&F;
F.len = 0;
Result_67513 = 0;
Oldexitcode_67514 = 0;
F.line = 508;F.filename = "osproc.nim";
Oldexitcode_67514 = (*P_66267).Exitcode;
F.line = 509;F.filename = "osproc.nim";
LOC2 = waitpid(((NI) ((*P_66267).Id)), &(*P_66267).Exitcode, ((NI32) 0));
if (!(LOC2 < 0)) goto LA3;
F.line = 511;F.filename = "osproc.nim";
(*P_66267).Exitcode = Oldexitcode_67514;
LA3: ;
F.line = 512;F.filename = "osproc.nim";
Result_67513 = ((NI) ((*P_66267).Exitcode));
framePtr = framePtr->prev;
return Result_67513;
}
N_NIMCALL(TY65027*, nospinputStream)(TY66202* P_66270) {
TY65027* Result_67521;
FILE* F_67522;
NIM_BOOL LOC2;
TY65323* LOC5;
volatile struct {TFrame* prev;NCSTRING procname;NI line;NCSTRING filename;NI len;
} F;
F.procname = "inputStream";
F.prev = framePtr;
F.filename = "/home/andreas/projects/nimrod/lib/pure/osproc.nim";
F.line = 0;
framePtr = (TFrame*)&F;
F.len = 0;
Result_67521 = 0;
F_67522 = 0;
F.line = 516;F.filename = "osproc.nim";
LOC2 = Open_3624(&F_67522, (*P_66270).Inputhandle, ((NU8) 1));
if (!!(LOC2)) goto LA3;
F.line = 516;F.filename = "osproc.nim";
nosOSError(((NimStringDesc*) &TMP66685));
LA3: ;
F.line = 517;F.filename = "osproc.nim";
LOC5 = 0;
LOC5 = Newfilestream_65354(F_67522);
Result_67521 = &LOC5->Sup;
framePtr = framePtr->prev;
return Result_67521;
}
N_NIMCALL(TY65027*, nospoutputStream)(TY66202* P_66273) {
TY65027* Result_67527;
FILE* F_67528;
NIM_BOOL LOC2;
TY65323* LOC5;
volatile struct {TFrame* prev;NCSTRING procname;NI line;NCSTRING filename;NI len;
} F;
F.procname = "outputStream";
F.prev = framePtr;
F.filename = "/home/andreas/projects/nimrod/lib/pure/osproc.nim";
F.line = 0;
framePtr = (TFrame*)&F;
F.len = 0;
Result_67527 = 0;
F_67528 = 0;
F.line = 521;F.filename = "osproc.nim";
LOC2 = Open_3624(&F_67528, (*P_66273).Outputhandle, ((NU8) 0));
if (!!(LOC2)) goto LA3;
F.line = 521;F.filename = "osproc.nim";
nosOSError(((NimStringDesc*) &TMP66685));
LA3: ;
F.line = 522;F.filename = "osproc.nim";
LOC5 = 0;
LOC5 = Newfilestream_65354(F_67528);
Result_67527 = &LOC5->Sup;
framePtr = framePtr->prev;
return Result_67527;
}
N_NIMCALL(TY65027*, nosperrorStream)(TY66202* P_66276) {
TY65027* Result_67533;
FILE* F_67534;
NIM_BOOL LOC2;
TY65323* LOC5;
volatile struct {TFrame* prev;NCSTRING procname;NI line;NCSTRING filename;NI len;
} F;
F.procname = "errorStream";
F.prev = framePtr;
F.filename = "/home/andreas/projects/nimrod/lib/pure/osproc.nim";
F.line = 0;
framePtr = (TFrame*)&F;
F.len = 0;
Result_67533 = 0;
F_67534 = 0;
F.line = 526;F.filename = "osproc.nim";
LOC2 = Open_3624(&F_67534, (*P_66276).Errorhandle, ((NU8) 0));
if (!!(LOC2)) goto LA3;
F.line = 526;F.filename = "osproc.nim";
nosOSError(((NimStringDesc*) &TMP66685));
LA3: ;
F.line = 527;F.filename = "osproc.nim";
LOC5 = 0;
LOC5 = Newfilestream_65354(F_67534);
Result_67533 = &LOC5->Sup;
framePtr = framePtr->prev;
return Result_67533;
}
N_NIMCALL(NI, nospexecCmd)(NimStringDesc* Command_66231) {
NI Result_67542;
int LOC1;
volatile struct {TFrame* prev;NCSTRING procname;NI line;NCSTRING filename;NI len;
} F;
F.procname = "execCmd";
F.prev = framePtr;
F.filename = "/home/andreas/projects/nimrod/lib/pure/osproc.nim";
F.line = 0;
framePtr = (TFrame*)&F;
F.len = 0;
Result_67542 = 0;
F.line = 532;F.filename = "osproc.nim";
LOC1 = system(Command_66231->data);
Result_67542 = ((NI) (LOC1));
framePtr = framePtr->prev;
return Result_67542;
}
N_NOINLINE(void, osprocInit)(void) {
volatile struct {TFrame* prev;NCSTRING procname;NI line;NCSTRING filename;NI len;
} F;
F.procname = "osproc";
F.prev = framePtr;
F.filename = "/home/andreas/projects/nimrod/lib/pure/osproc.nim";
F.line = 0;
framePtr = (TFrame*)&F;
F.len = 0;
framePtr = framePtr->prev;
}

